[tox]
envlist = py3, lint, docs
# tox does not yet support PEP518 for building sdist
skipsdist = True

[testenv]
deps = poetry
commands =
    poetry install -v
    poetry run pytest --cov=fresh_baked_skeleton

# PHONY env to run all linters (run async with detox)
[testenv:lint]
deps =
    detox
commands =
    detox -e flake8,pylint,isort,bandit,mypy,black

[testenv:flake8]
deps =
    flake8
commands =
    flake8 fresh_baked_skeleton

[testenv:pylint]
deps =
    pylint
commands =
    pylint fresh_baked_skeleton

[testenv:isort]
deps =
    isort
commands =
    isort fresh_baked_skeleton --check-only

[testenv:bandit]
deps =
    bandit
commands =
    bandit -r fresh_baked_skeleton

[testenv:mypy]
# Can't run mypy on pypy
deps =
    py{33,35,36}: poetry
commands =
    py{33,35,36}: poetry install -v --extras mypy
    py{33,35,36}: poetry run mypy fresh_baked_skeleton

[testenv:black]
# black is only available on 3.6
deps =
    py36: black
commands =
    py36: black fresh_baked_skeleton --check --skip-string-normalization

[testenv:docs]
changedir = docs
deps =
    sphinx
    sphinx-rtd-theme
    sphinxcontrib-apidoc
commands =
    sphinx-build -W -b html -d {envtmpdir}/doctrees . {envtmpdir}/html
